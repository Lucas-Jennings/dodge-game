<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dodge the Squares</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #111;
      color: #fff;
      font-family: system-ui, sans-serif;
      overflow: hidden;
    }
    h1, #info, #hud {
      position: absolute;
      z-index: 10;
      left: 20px;
      text-shadow: 0 0 6px #000;
    }
    h1 { top: 10px; font-size: 24px; }
    #info { top: 45px; font-size: 14px; opacity: 0.8; }
    #hud { top: 70px; display: flex; gap: 20px; font-size: 14px; }

    #gameContainer {
      position: absolute;
      inset: 0;
      width: 100vw;
      height: 100vh;
      background: radial-gradient(circle at top, #333, #000);
      overflow: hidden;
    }

    #player, .enemy {
      position: absolute;
      border-radius: 4px;
    }
    #player {
      width: 24px;
      height: 24px;
      background: #4caf50;
      box-shadow: 0 0 10px #4caf50;
    }
    .enemy {
      width: 20px;
      height: 20px;
      background: #e91e63;
      box-shadow: 0 0 10px #e91e63;
    }

    #gameOverScreen {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 20px;
      text-align: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    #gameOverScreen.show {
      opacity: 1;
      pointer-events: auto;
    }

    button {
      margin-top: 10px;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      background: #2196f3;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background: #1976d2;
    }
  </style>
</head>
<body>

  <h1>Dodge the Squares</h1>
  <div id="info">Move with Arrow Keys or WASD. Survive as long as you can.</div>

  <div id="hud">
    <div>Time: <span id="time">0.0</span>s</div>
    <div>Best: <span id="best">0.0</span>s</div>
    <div>Enemies: <span id="enemyCount">0</span></div>
  </div>

  <div id="gameContainer">
    <div id="player"></div>
    <div id="gameOverScreen">
      <div id="gameOverText"></div>
      <button id="restartBtn">Play Again</button>
    </div>
  </div>

  <script>
    /* ------------------------------
       FULLSCREEN ON GAME START
    ------------------------------ */
    function goFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(() => {});
      }
    }

    /* ------------------------------
       ORIGINAL GAME CODE
    ------------------------------ */

    const container = document.getElementById('gameContainer');
    const playerEl = document.getElementById('player');
    const timeEl = document.getElementById('time');
    const bestEl = document.getElementById('best');
    const enemyCountEl = document.getElementById('enemyCount');
    const gameOverScreen = document.getElementById('gameOverScreen');
    const gameOverText = document.getElementById('gameOverText');
    const restartBtn = document.getElementById('restartBtn');

    let width = window.innerWidth;
    let height = window.innerHeight;

    window.addEventListener('resize', () => {
      width = window.innerWidth;
      height = window.innerHeight;
    });

    let keys = {};
    let player = { x: width / 2 - 12, y: height / 2 - 12, speed: 6 };
    let enemies = [];
    let running = false;
    let startTime = 0;
    let lastTime = 0;
    let spawnTimer = 0;
    let bestTime = parseFloat(localStorage.getItem('dodgeBestTime') || '0') || 0;
    bestEl.textContent = bestTime.toFixed(1);

    document.addEventListener('keydown', e => {
      keys[e.key.toLowerCase()] = true;
      if (!running && e.key === ' ') startGame();
    });
    document.addEventListener('keyup', e => {
      keys[e.key.toLowerCase()] = false;
    });

    restartBtn.addEventListener('click', startGame);

    function resetGame() {
      enemies.forEach(e => e.el.remove());
      enemies = [];
      player.x = width / 2 - 12;
      player.y = height / 2 - 12;
      spawnTimer = 0;
      timeEl.textContent = '0.0';
      enemyCountEl.textContent = '0';
      gameOverScreen.classList.remove('show');
    }

    function startGame() {
      goFullscreen(); // â­ Fullscreen triggered by SPACE or button click
      resetGame();
      running = true;
      startTime = performance.now();
      lastTime = startTime;
      requestAnimationFrame(loop);
    }

    function endGame(survivalTime) {
      running = false;
      if (survivalTime > bestTime) {
        bestTime = survivalTime;
        localStorage.setItem('dodgeBestTime', bestTime.toString());
        bestEl.textContent = bestTime.toFixed(1);
      }
      gameOverText.innerHTML =
        `You survived <b>${survivalTime.toFixed(1)}</b>s<br>` +
        `Best: <b>${bestTime.toFixed(1)}</b>s<br><br>` +
        `<small>Press Space or "Play Again"</small>`;
      gameOverScreen.classList.add('show');
    }

    function spawnEnemy() {
      const el = document.createElement('div');
      el.className = 'enemy';

      const edge = Math.floor(Math.random() * 4);
      let x, y;

      if (edge === 0) { x = Math.random() * width; y = -20; }
      else if (edge === 1) { x = Math.random() * width; y = height + 20; }
      else if (edge === 2) { x = -20; y = Math.random() * height; }
      else { x = width + 20; y = Math.random() * height; }

      container.appendChild(el);
      enemies.push({ x, y, vx: 0, vy: 0, el });
      enemyCountEl.textContent = enemies.length;
    }

    function handleEnemyCollisions() {
      for (let i = 0; i < enemies.length; i++) {
        for (let j = i + 1; j < enemies.length; j++) {
          const a = enemies[i];
          const b = enemies[j];

          const dx = b.x - a.x;
          const dy = b.y - a.y;
          const dist = Math.hypot(dx, dy);

          if (dist < 20) {
            const angle = Math.atan2(dy, dx);
            const force = 6;

            a.vx -= Math.cos(angle) * force;
            a.vy -= Math.sin(angle) * force;

            b.vx += Math.cos(angle) * force;
            b.vy += Math.sin(angle) * force;
          }
        }
      }
    }

    function updateEnemies(dt) {
      handleEnemyCollisions();

      for (let i = enemies.length - 1; i >= 0; i--) {
        const e = enemies[i];

        const dx = player.x - e.x;
        const dy = player.y - e.y;
        const dist = Math.hypot(dx, dy);

        const ndx = dx / dist;
        const ndy = dy / dist;

        const speedBoost = Math.min(2.5, (performance.now() - startTime) / 9000);
        const speed = 2.2 + speedBoost * 0.9;

        e.vx += ndx * speed * 0.05;
        e.vy += ndy * speed * 0.05;

        e.x += e.vx * dt;
        e.y += e.vy * dt;

        e.vx *= 0.95;
        e.vy *= 0.95;

        if (e.x < -100 || e.x > width + 100 || e.y < -100 || e.y > height + 100) {
          e.el.remove();
          enemies.splice(i, 1);
          continue;
        }

        e.el.style.transform = `translate(${e.x}px, ${e.y}px)`;

        if (
          e.x < player.x + 24 &&
          e.x + 20 > player.x &&
          e.y < player.y + 24 &&
          e.y + 20 > player.y
        ) {
          return true;
        }
      }
      return false;
    }

    function updatePlayer(dt) {
      let dx = 0, dy = 0;
      if (keys['arrowup'] || keys['w']) dy -= 1;
      if (keys['arrowdown'] || keys['s']) dy += 1;
      if (keys['arrowleft'] || keys['a']) dx -= 1;
      if (keys['arrowright'] || keys['d']) dx += 1;

      if (dx !== 0 || dy !== 0) {
        const len = Math.hypot(dx, dy);
        dx /= len;
        dy /= len;
      }

      player.x += dx * player.speed * dt;
      player.y += dy * player.speed * dt;

      player.x = Math.max(0, Math.min(width - 24, player.x));
      player.y = Math.max(0, Math.min(height - 24, player.y));

      playerEl.style.transform = `translate(${player.x}px, ${player.y}px)`;
    }

    function loop(timestamp) {
      if (!running) return;
      const dtMs = timestamp - lastTime;
      lastTime = timestamp;
      const dt = dtMs / 16.67;

      const elapsed = (timestamp - startTime) / 1000;
      timeEl.textContent = elapsed.toFixed(1);

      const spawnInterval = Math.max(450, 1300 - elapsed * 50);
      spawnTimer += dtMs;
      if (spawnTimer >= spawnInterval) {
        spawnTimer = 0;
        spawnEnemy();
      }

      updatePlayer(dt);
      const hit = updateEnemies(dt);

      if (hit) {
        endGame(elapsed);
      } else {
        requestAnimationFrame(loop);
      }
    }

    gameOverText.innerHTML =
      `Press Space to start<br>` +
      `<small>Move with Arrow Keys or WASD</small>`;
    gameOverScreen.classList.add('show');
  </script>
</body>
</html>
