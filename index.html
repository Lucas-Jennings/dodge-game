<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DODGE</title>

  <!-- Futuristic font -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: #050505;
      color: #fff;
      font-family: 'Orbitron', system-ui, sans-serif;
      overflow: hidden;
      letter-spacing: 0.5px;
    }

    /* --- TITLE --- */
    h1 {
      position: absolute;
      top: 30px;
      width: 100%;
      text-align: center;
      font-size: 42px;
      font-weight: 700;
      color: #00eaff;
      text-shadow: 0 0 12px #00eaff;
      pointer-events: none;
      z-index: 10;
    }

    /* --- SUBTEXT --- */
    #info {
      position: absolute;
      top: 90px;
      width: 100%;
      text-align: center;
      font-size: 16px;
      opacity: 0.75;
      color: #b0faff;
      text-shadow: 0 0 6px #003b44;
      z-index: 10;
    }

    /* --- HUD --- */
    #hud {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 20px;
      font-size: 16px;
      padding: 10px 18px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      backdrop-filter: blur(6px);
      box-shadow: 0 0 12px rgba(0,255,255,0.2);
      z-index: 10;
    }

    #gameContainer {
      position: absolute;
      inset: 0;
      width: 100vw;
      height: 100vh;
      background: radial-gradient(circle at center, #111, #000);
      overflow: hidden;
    }

    /* --- PLAYER + ENEMIES --- */
    #player, .enemy {
      position: absolute;
      border-radius: 6px;
    }

    #player {
      width: 26px;
      height: 26px;
      background: #00ff9d;
      box-shadow: 0 0 14px #00ff9d;
      z-index: 2;
    }

    .enemy {
      width: 22px;
      height: 22px;
      background: #ff005d;
      box-shadow: 0 0 14px #ff005d;
      z-index: 1; /* behind UI and player */
    }

    /* --- GAME OVER SCREEN --- */
    #gameOverScreen {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 22px;
      text-align: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      z-index: 20; /* always on top */
    }

    #gameOverScreen.show {
      opacity: 1;
      pointer-events: auto;
    }

    button {
      margin-top: 20px;
      padding: 10px 22px;
      border: none;
      border-radius: 6px;
      background: #00eaff;
      color: #000;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 0 10px #00eaff;
      transition: 0.2s;
    }

    button:hover {
      background: #00bcd4;
      box-shadow: 0 0 16px #00bcd4;
    }
  </style>
</head>
<body>

  <h1>DODGE</h1>
  <div id="info">Move with Arrow Keys or WASD. Press Space to Start.</div>

  <div id="hud">
    <div>Time: <span id="time">0.0</span>s</div>
    <div>Best: <span id="best">0.0</span>s</div>
    <div>Enemies: <span id="enemyCount">0</span></div>
  </div>

  <div id="gameContainer">
    <div id="player"></div>

    <div id="gameOverScreen">
      <div id="gameOverText"></div>
      <button id="restartBtn">Play Again</button>
    </div>
  </div>

  <script>
    /* ------------------------------
       FULLSCREEN
    ------------------------------ */
    function goFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(() => {});
      }
    }

    /* ------------------------------
       GAME ELEMENTS
    ------------------------------ */
    const container = document.getElementById('gameContainer');
    const playerEl = document.getElementById('player');
    const timeEl = document.getElementById('time');
    const bestEl = document.getElementById('best');
    const enemyCountEl = document.getElementById('enemyCount');
    const gameOverScreen = document.getElementById('gameOverScreen');
    const gameOverText = document.getElementById('gameOverText');
    const restartBtn = document.getElementById('restartBtn');

    let width = window.innerWidth;
    let height = window.innerHeight;

    window.addEventListener('resize', () => {
      width = window.innerWidth;
      height = window.innerHeight;
    });

    let keys = {};
    let player = { x: width / 2, y: height / 2, speed: 6 };
    let enemies = [];
    let running = false;
    let startTime = 0;
    let lastTime = 0;
    let spawnTimer = 0;

    let bestTime = parseFloat(localStorage.getItem('neonDodgeBest') || '0');
    bestEl.textContent = bestTime.toFixed(1);

    /* ------------------------------
       INPUT
    ------------------------------ */
    document.addEventListener('keydown', e => {
      keys[e.key.toLowerCase()] = true;
      if (!running && e.key === ' ') startGame();
    });

    document.addEventListener('keyup', e => {
      keys[e.key.toLowerCase()] = false;
    });

    restartBtn.addEventListener('click', startGame);

    /* ------------------------------
       GAME CONTROL
    ------------------------------ */
    function resetGame() {
      enemies.forEach(e => e.el.remove());
      enemies = [];

      player.x = width / 2;
      player.y = height / 2;

      spawnTimer = 0;
      timeEl.textContent = '0.0';
      enemyCountEl.textContent = '0';

      gameOverScreen.classList.remove('show');
    }

    function startGame() {
      goFullscreen();
      resetGame();

      running = true;
      startTime = performance.now();
      lastTime = startTime;

      requestAnimationFrame(loop);
    }

    function endGame(survivalTime) {
      running = false;

      if (survivalTime > bestTime) {
        bestTime = survivalTime;
        localStorage.setItem('neonDodgeBest', bestTime.toString());
        bestEl.textContent = bestTime.toFixed(1);
      }

      gameOverText.innerHTML =
        `You survived <b>${survivalTime.toFixed(1)}</b>s<br>` +
        `Best: <b>${bestTime.toFixed(1)}</b>s<br><br>` +
        `<small>Press Space or "Play Again"</small>`;

      gameOverScreen.classList.add('show');
    }

    /* ------------------------------
       ENEMY SPAWNING
    ------------------------------ */
    function spawnEnemy() {
      const el = document.createElement('div');
      el.className = 'enemy';

      const edge = Math.floor(Math.random() * 4);
      let x, y;

      if (edge === 0) { x = Math.random() * width; y = -30; }
      else if (edge === 1) { x = Math.random() * width; y = height + 30; }
      else if (edge === 2) { x = -30; y = Math.random() * height; }
      else { x = width + 30; y = Math.random() * height; }

      container.appendChild(el);
      enemies.push({ x, y, vx: 0, vy: 0, el });

      enemyCountEl.textContent = enemies.length;
    }

    /* ------------------------------
       ENEMY COLLISIONS (BOUNCE)
    ------------------------------ */
    function handleEnemyCollisions() {
      const minDist = 24; // enemy size + buffer

      for (let i = 0; i < enemies.length; i++) {
        for (let j = i + 1; j < enemies.length; j++) {
          const a = enemies[i];
          const b = enemies[j];

          const dx = b.x - a.x;
          const dy = b.y - a.y;
          const dist = Math.hypot(dx, dy);

          if (dist > 0 && dist < minDist) {
            const angle = Math.atan2(dy, dx);

            // Stronger bounce force
            const force = 14;

            a.vx -= Math.cos(angle) * force;
            a.vy -= Math.sin(angle) * force;

            b.vx += Math.cos(angle) * force;
            b.vy += Math.sin(angle) * force;

            // Push them apart so they don't overlap
            const overlap = minDist - dist;
            const push = overlap * 0.5;

            a.x -= Math.cos(angle) * push;
            a.y -= Math.sin(angle) * push;

            b.x += Math.cos(angle) * push;
            b.y += Math.sin(angle) * push;
          }
        }
      }
    }

    /* ------------------------------
       ENEMY MOVEMENT + PLAYER HIT
    ------------------------------ */
    function updateEnemies(dt) {
      handleEnemyCollisions();

      for (let i = enemies.length - 1; i >= 0; i--) {
        const e = enemies[i];

        const dx = player.x - e.x;
        const dy = player.y - e.y;
        const dist = Math.hypot(dx, dy);

        const ndx = dx / dist;
        const ndy = dy / dist;

        const speedBoost = Math.min(2.5, (performance.now() - startTime) / 9000);
        const speed = 2.2 + speedBoost * 0.9;

        e.vx += ndx * speed * 0.05;
        e.vy += ndy * speed * 0.05;

        e.x += e.vx * dt;
        e.y += e.vy * dt;

        e.vx *= 0.95;
        e.vy *= 0.95;

        e.el.style.transform = `translate(${e.x}px, ${e.y}px)`;

        // Player collision
        if (
          e.x < player.x + 26 &&
          e.x + 22 > player.x &&
          e.y < player.y + 26 &&
          e.y + 22 > player.y
        ) {
          return true;
        }
      }
      return false;
    }

    /* ------------------------------
       PLAYER MOVEMENT
    ------------------------------ */
    function updatePlayer(dt) {
      let dx = 0, dy = 0;

      if (keys['arrowup'] || keys['w']) dy -= 1;
      if (keys['arrowdown'] || keys['s']) dy += 1;
      if (keys['arrowleft'] || keys['a']) dx -= 1;
      if (keys['arrowright'] || keys['d']) dx += 1;

      if (dx !== 0 || dy !== 0) {
        const len = Math.hypot(dx, dy);
        dx /= len;
        dy /= len;
      }

      player.x += dx * player.speed * dt;
      player.y += dy * player.speed * dt;

      player.x = Math.max(0, Math.min(width - 26, player.x));
      player.y = Math.max(0, Math.min(height - 26, player.y));

      playerEl.style.transform = `translate(${player.x}px, ${player.y}px)`;
    }

    /* ------------------------------
       MAIN LOOP
    ------------------------------ */
    function loop(timestamp) {
      if (!running) return;

      const dtMs = timestamp - lastTime;
      lastTime = timestamp;
      const dt = dtMs / 16.67;

      const elapsed = (timestamp - startTime) / 1000;
      timeEl.textContent = elapsed.toFixed(1);

      const spawnInterval = Math.max(450, 1300 - elapsed * 50);
      spawnTimer += dtMs;

      if (spawnTimer >= spawnInterval) {
        spawnTimer = 0;
        spawnEnemy();
      }

      updatePlayer(dt);
      const hit = updateEnemies(dt);

      if (hit) {
        endGame(elapsed);
      } else {
        requestAnimationFrame(loop);
      }
    }

    /* ------------------------------
       INITIAL SCREEN
    ------------------------------ */
    gameOverText.innerHTML =
      `Press Space to start<br>` +
      `<small>Move with Arrow Keys or WASD</small>`;
    gameOverScreen.classList.add('show');
  </script>
</body>
</html>
